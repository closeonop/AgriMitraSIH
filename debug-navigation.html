<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Navigation - AgriMitra</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .debug-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #45a049;
        }
        .log {
            background: #f9f9f9;
            padding: 10px;
            border-left: 4px solid #2196F3;
            margin: 10px 0;
            font-family: monospace;
        }
        .error {
            border-left-color: #f44336;
            background: #ffebee;
        }
        .success {
            border-left-color: #4CAF50;
            background: #e8f5e9;
        }
    </style>
</head>
<body>
    <h1>üîç AgriMitra Navigation Debug Tool</h1>
    
    <div class="debug-panel">
        <h2>Navigation Tests</h2>
        <button class="test-button" onclick="testDirectAccess()">Test Direct Access</button>
        <button class="test-button" onclick="testNavigationFunction()">Test Navigation Function</button>
        <button class="test-button" onclick="testChatBotComponent()">Test ChatBot Component</button>
        <button class="test-button" onclick="clearLogs()">Clear Logs</button>
    </div>

    <div class="debug-panel">
        <h2>Current Status</h2>
        <div id="status">Initializing...</div>
    </div>

    <div class="debug-panel">
        <h2>Debug Logs</h2>
        <div id="logs"></div>
    </div>

    <script>
        let logContainer = document.getElementById('logs');
        let statusContainer = document.getElementById('status');

        function log(message, type = 'info') {
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(logDiv);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateStatus(message) {
            statusContainer.innerHTML = message;
        }

        function clearLogs() {
            logContainer.innerHTML = '';
        }

        function testDirectAccess() {
            log('üîó Testing direct access to localhost:3004...', 'info');
            
            fetch('http://localhost:3004/')
                .then(response => {
                    if (response.ok) {
                        log('‚úÖ Server is accessible', 'success');
                        updateStatus('‚úÖ Server Running');
                        return response.text();
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                })
                .then(html => {
                    log(`üìÑ Page loaded successfully (${html.length} characters)`, 'success');
                    
                    // Check if React app is loaded
                    if (html.includes('react') || html.includes('vite') || html.includes('AgriMitra')) {
                        log('‚öõÔ∏è React application detected in HTML', 'success');
                    } else {
                        log('‚ö†Ô∏è React application not detected in HTML', 'error');
                    }
                })
                .catch(error => {
                    log(`‚ùå Failed to access server: ${error.message}`, 'error');
                    updateStatus('‚ùå Server Error');
                });
        }

        function testNavigationFunction() {
            log('üß™ Testing navigation function simulation...', 'info');
            
            // Open the main app in a new window
            const appWindow = window.open('http://localhost:3004/', 'agrimitra-test');
            
            if (appWindow) {
                log('ü™ü Opened app in new window', 'success');
                
                setTimeout(() => {
                    try {
                        // Try to access the app's navigation function
                        appWindow.postMessage({
                            type: 'NAVIGATE_TO_CHATBOT',
                            page: 'chatbot'
                        }, 'http://localhost:3004');
                        
                        log('üì§ Sent navigation message to app window', 'success');
                    } catch (error) {
                        log(`‚ùå Failed to send navigation message: ${error.message}`, 'error');
                    }
                }, 2000);
            } else {
                log('‚ùå Failed to open app window (popup blocked?)', 'error');
            }
        }

        function testChatBotComponent() {
            log('ü§ñ Testing ChatBot component accessibility...', 'info');
            
            // Test if we can load the component file
            fetch('http://localhost:3004/src/pages/ChatBot.tsx')
                .then(response => {
                    if (response.ok) {
                        log('‚úÖ ChatBot.tsx file is accessible', 'success');
                        return response.text();
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                })
                .then(content => {
                    log(`üìÑ ChatBot component loaded (${content.length} characters)`, 'success');
                    
                    // Check for common issues
                    if (content.includes('export default')) {
                        log('‚úÖ Component has default export', 'success');
                    } else {
                        log('‚ö†Ô∏è Component missing default export', 'error');
                    }
                    
                    if (content.includes('useState') || content.includes('useEffect')) {
                        log('‚úÖ Component uses React hooks', 'success');
                    }
                })
                .catch(error => {
                    log(`‚ùå Failed to load ChatBot component: ${error.message}`, 'error');
                });
        }

        // Initialize
        window.addEventListener('load', () => {
            log('üöÄ Debug tool initialized', 'success');
            updateStatus('üîç Ready for testing');
            
            // Auto-test server accessibility
            setTimeout(testDirectAccess, 1000);
        });

        // Listen for messages from the main app
        window.addEventListener('message', (event) => {
            if (event.origin === 'http://localhost:3004') {
                log(`üì® Received message from app: ${JSON.stringify(event.data)}`, 'info');
            }
        });
    </script>
</body>
</html>